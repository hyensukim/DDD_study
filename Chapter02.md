# 🎆 아키텍처 개요

> 핵심 학습 목표

✅ 아키텍처

✅ DIP

✅ 도메인 영역의 주요 구성 요소

✅ 인프라스트럭처

✅ 모듈

## 2.1 네 개의 영역

아키텍처를 설계할 때 출현하는 전형적인 4가지 영역 - 표현, 응용, 도메인, 인프라스트럭처

> 표현 영역

- 사용자 요청을 응용영역에 전달 후 응용영역에 처리한 결과를 사용자에게 보여준다.
- 스프링 MVC 프레임워크 는 표현 영역을 위한 기술이다.
- HTTP 요청 시 전달된 데이터를 응용영역에서 사용할 데이터로 변환 후 전달해준다.

> 응용 영역

- 시스템이 사용자에게 제공해야 할 기능 구현.
- 기능 구현을 위해 도메인 모델을 사용
- [❓로직을 직접 구현하지 않고, 도메인 영역에 로직 수행을 위임한다.]()

> 도메인 영역

- 도메인 모델을 구현.
- 도메인 핵심 로직을 구현.

> 인프라스트럭처 영역

- 도메인, 응용, 표현 영역은 구현 기술을 사용한 코드를 직접 만들지 않고, 인프라스트럭처 영역에서 제공하는 기능을 사용하여 필요한 기능을 개발한다.
- 구현 기술
  - RDBMS 연동
  - 메시지 큐 메시지 전송/수신 기능
  - 몽고 DB, 레디스 와의 데이터 연동 처리
  - SMTP 서버


## 2.2 계층구조의 아키텍처

- 계층구조

```
표현 ➡️ 응용 ➡️ 도메인 ➡️ 인프라스트럭쳐
```

계층구조는 특성상 상위 계층에서 하위 계층으로의 의존만 존재하고 반대는 성립하지 않는다.

하지만, 편의를 위해 계층구조를 유연하게 조정하기도 하는데, 응용계층이 도메인이 아닌 인프라스트럭처 계층에 의존하는 경우이다.

```
응용 	➡️ 도메인(엔티티) ➡️ 인프라스트럭처
응용	➡️	인프라스트럭처

```

여기서 주목해야 할 점은 표현, 응용, 도메인 계층이 인프라스트럭처 계층에 종속된다는 점이다.

종속될 경우, 2가지 문제가 발생하게 된다.

- 테스트의 어려움
- 기능확장의 어려움

> 테스트의 어려움

인프라스트럭처 계층의 구현이 완변해야만 상위 계층의 기능 Test가 가능하다.

> 기능확장의 어려움

인프라스트럭처 계층에 의존 정도 너무 높기 때문에 수정 시 상위 계층의 코드에 많은 부분이 수정된다.

이러한 문제점을 해결하기 위한 것이 **DIP** 이다.


> ✅ 아키텍처

- 일반 계층 구조 '표현 --> 응용 --> 도메인 --> 인프라스트럭처' 구조이다.


## 2.3 DIP

인스트럭처 계층의 저수준 모듈과 응용 계층의 고수준 모듈이 있다.

고수준 모듈은 의미있는 단일 기능을 제공하며, 저수준 모듈은 이를 구성하는 내부 기능들을 의미한다.

즉, 고수준 모듈이 저수준 모듈에 의존하는 방식이 일반적이다.

하지만, 이는 테스트의 어려움과 기능 확장에 문제점을 갖는다.

이를 위해 DIP 라는 개념이 도입되었는데, DIP란 무엇인가?

DIP는 제어의 역전 원칙으로써, Dependency Inversion Principle 을 의미한다.

즉, 저수준 모듈이 고수준 모듈에 의존하는 것을 말한다.

하지만, 상식적으로 저수준 계층에 의존해야 기능이 완성되는 고수준 모듈에서 어떻게 의존을 역전한다는 건지 이해 되지 않는다.

이는 `인터페이스` 를 통해 추상화 모듈을 추가해줌으로써 가능하게 해준다.

```
기존 의존 관계
	고수준 모듈 --> 저수준 모듈

DIP 가 적용된 관계
	고수준 모듈 --> 인터페이스 ◁-- 저수준 모듈

```

이처럼 인터페이스로 추상화 계층을 추가해주면, 위 2가지 문제점들을 해결할 수 있다.

1. 구현 기술 교체 문제

저수준 모듈이 추상화 계층을 구현하고, 고수준 모듈에서 인터페이스에 의존을 하기 때문에 아래와 같은 코드로 작성하는 것이 가능하다.

```
인터페이스 변수명1 = new 저수준();


고수준 변수명2 = new 고수준(인터페이스 타입 변수명1);

```

위 코드는 기능이 수정될 경우  `new 저수준()` 코드만 바꿔주면, 고수준 모듈의 로직이 변경되기 때문에 고수준 모듈에서 수정할 부분이 없어진다.


2. 고수준 모듈 기능 테스트 문제

기존에는 고수준 모듈이 저수준 모듈에 직접 의존하여 저수준 모듈이 생성되기 전까지 테스트가 불가하였다.

하지만, DIP 적용 후 인터페이스 타입에 이를 구현한 대체 객체를 생성하여 테스트가 가능하므로, 2번 문제도 해결된다.


> ❓대체 객체(Mock)



### 2.3.1 DIP 주의사항

DIP를 적용한 목적에 집중하면, 함정으로 부터 무사할 수 있다.

DIP는 고수준 모듈이 저수준에 의존하는 것을 막기 위한 개념이다.

이를 지키기 위해서는 추상화의 대상이 고수준 모듈이어야 한다.


### 2.3.2 DIP와 아키텍처

일반 계층 구조와는 반대로 인프라스트럭처 계층이 응용과 도메인 계층에 의존하여 위쪽에 위치하게 된다.

물론 DIP를 통해 얻는 이점이 있지만, 그렇지 않은 경우나 추상화가 잘 떠오르지 않은 경우에는 어느정도 적용 범위를 검토할 필요가 있다.


>  ✅DIP

- 의존 역전의 원칙
- 고수준 모듈과 저수준 모듈 사이에 추상화 계층을 추가하여, 고수준이 저수준에 의존하는 정도를 줄여주는 개념.


## 2.4 도메인 영역의 주요 구성요소

## 2.5 요청 처리 흐름

## 2.6 인프라스트럭처 개요

## 2.7 모듈 구성
